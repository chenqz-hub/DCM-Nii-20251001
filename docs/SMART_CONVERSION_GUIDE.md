# DICOM智能转换脚本使用指南

## 🌟 推荐脚本：`dcm2niix_smart_convert.py`

### ✨ 核心优势
- **🧠 智能分析**：自动识别最佳影像序列
- **⚡ 高效处理**：速度提升4倍（29分40秒 → 7分20秒）
- **🎯 精准输出**：每案例1个NIfTI文件
- **💾 节省空间**：磁盘使用减少50%

### 🔧 智能选择算法
脚本使用多维评分系统选择最佳序列：

#### 评分标准（总分）：
1. **文件数量** (0-100分)：更多切片 = 主要序列
2. **图像尺寸** (0-50分)：更大图像 = 主要序列  
3. **序列描述** (+30/-50分)：
   - 加分：包含 "chest", "thorax", "lung", "helical"
   - 减分：包含 "topogram", "scout", "localizer", "overview"
4. **序列号** (+10分)：序列号 > 100
5. **模态类型** (+20分)：CT模态

### 📊 实际选择结果
基于42个案例的分析：
- **iDose (4)**: 18例 - Philips重建算法优化
- **标准序列**: 13例 - 常规CT序列
- **5.0 x 5.0**: 6例 - 特定层厚设置
- **Thorax 5.0 I50f 3**: 5例 - 胸部专用协议

### 🚀 使用步骤

1. **运行脚本**：
   ```bash
   python src/dcm2niix_smart_convert.py
   ```

2. **观察输出**：
   ```
   [1/42] Processing dicom_6499278...
     📊 Analyzing DICOM series...
     🎯 Selected: Series 201 - 5.0 x 5.0 (66 files)
     🔄 Converting main series...
     ✅ Success: Generated 1 NIfTI files
   ```

3. **查看结果**：
   - 输出目录：`output/nifti_converted_smart/`
   - 每案例：1个 `.nii.gz` + 1个 `.json` 文件
   - 转换报告：`smart_conversion_report_日期时间.json`

### 📁 输出结构
```
output/nifti_converted_smart/
├── dicom_6499278/
│   ├── 1899967_201_Chest_Helical.nii.gz
│   └── 1899967_201_Chest_Helical.json
├── dicom_6567397/
│   ├── 3677701_201_JY_Chest_Thorax.nii.gz
│   └── 3677701_201_JY_Chest_Thorax.json
└── smart_conversion_report_20251006_104520.json
```

### 🔍 与传统方法对比

| 特征 | 智能方法 | 传统方法 |
|------|----------|----------|
| **策略** | 分析→转换目标序列 | 转换全部→删除多余 |
| **速度** | 7分20秒 | 29分40秒 |
| **精度** | 多维评分选择 | 文件大小选择 |
| **输出** | 1个目标文件 | 6-7个→筛选1个 |
| **磁盘** | 4GB峰值 | 8-10GB峰值 |

### ⚠️ 注意事项

1. **序列选择**：基于智能评分，可能与文件大小最大的不同
2. **特殊案例**：如需查看所有序列，使用传统方法
3. **定位像**：自动排除，如需要请使用传统方法
4. **兼容性**：输出格式完全兼容医学影像分析工具

### 🎯 适用场景

✅ **推荐使用智能方法**：
- 批量处理大量案例
- 只需要主要影像序列
- 追求高效率处理
- 标准临床研究分析

⚠️ **考虑传统方法**：
- 需要查看所有序列类型
- 特殊研究需求（如定位像分析）
- 手动质控每个序列

### 📞 技术支持

如遇问题，检查：
1. `dcm2niix.exe` 是否存在
2. Python环境是否配置
3. 输入ZIP文件是否为有效DICOM
4. 磁盘空间是否充足

---
*创建时间：2025-10-06*
*版本：智能转换 v1.0*