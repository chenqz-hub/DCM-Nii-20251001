# DCM-Nii 全新电脑安装指南

> **适用场景**: 在一台全新的Windows电脑上从零开始安装DCM-Nii v2.0.0

---

## 📋 目录

1. [系统要求](#系统要求)
2. [轻量版安装步骤](#轻量版安装步骤)
3. [完整版安装步骤](#完整版安装步骤)
4. [常见问题](#常见问题)
5. [验证安装](#验证安装)

---

## 💻 系统要求

### 基础要求（两个版本通用）

| 项目 | 轻量版 | 完整版 |
|------|--------|--------|
| **操作系统** | Windows 7/8/10/11 (64位) | Windows 7/8/10/11 (64位) |
| **磁盘空间** | 1GB+ (处理数据需更多) | 2GB+ (处理数据需更多) |
| **内存** | 4GB+ (推荐8GB) | 8GB+ (推荐16GB) |
| **显卡** | 无特殊要求 | 支持OpenGL 2.0+ |
| **网络** | 下载依赖需联网 | 下载依赖需联网 |

### 软件依赖

**必需组件**：
1. ✅ **Python 3.8-3.11** (推荐3.10)
2. ✅ **pip** (Python包管理器，通常随Python安装)

**可选组件**：
- Git (如果需要从GitHub克隆仓库)
- 文本编辑器 (记事本即可，推荐VS Code)

---

## 🪶 轻量版安装步骤

### 第一步：安装Python

#### 方法1：从Python官网下载（推荐）

1. **下载Python安装包**
   - 访问：https://www.python.org/downloads/
   - 下载：Python 3.10.x (Windows installer 64-bit)
   
2. **安装Python**
   ```
   ✅ 勾选 "Add Python 3.10 to PATH" （重要！）
   ✅ 点击 "Install Now"
   ✅ 等待安装完成
   ```

3. **验证安装**
   - 按 `Win + R`，输入 `cmd`，回车
   - 运行以下命令：
   ```cmd
   python --version
   ```
   - 应显示：`Python 3.10.x`

#### 方法2：使用Microsoft Store

1. 打开 Microsoft Store
2. 搜索 "Python 3.10"
3. 点击"获取"安装
4. 安装后验证（同上）

### 第二步：下载并解压轻量版

1. **下载分发包**
   - 文件：`DCM-Nii_lightweight_20251025_130059.zip` (0.56 MB)
   - 来源：GitHub Releases 或项目分发

2. **解压文件**
   ```powershell
   # 方法1: 使用Windows资源管理器
   右键点击ZIP文件 → 全部解压缩 → 选择目标文件夹
   
   # 方法2: 使用PowerShell
   Expand-Archive -Path DCM-Nii_lightweight_20251025_130059.zip -DestinationPath C:\DCM-Nii
   ```

3. **解压后的目录结构**
   ```
   C:\DCM-Nii\
   ├── src/                          # Python脚本
   ├── docs/                         # 文档
   ├── data/                         # 数据目录
   ├── output/                       # 输出目录
   ├── dcm2niix.exe                  # DICOM转换工具
   ├── start_tools.bat               # 启动器
   ├── README.md                     # 项目说明
   └── requirements.txt              # Python依赖
   ```

### 第三步：安装Python依赖

1. **打开命令行**
   ```powershell
   # 按 Win + R，输入 cmd，回车
   # 进入解压目录
   cd C:\DCM-Nii
   ```

2. **安装依赖包**
   ```powershell
   pip install -r requirements.txt
   ```
   
3. **等待安装完成**
   ```
   安装的包：
   - pydicom >= 2.3.0  (DICOM文件处理)
   - pandas >= 1.5.0   (数据处理)
   - numpy >= 1.20.0   (数值计算)
   
   预计时间：1-3分钟（取决于网速）
   ```

4. **验证安装**
   ```powershell
   python -c "import pydicom, pandas, numpy; print('依赖安装成功！')"
   ```
   - 应显示：`依赖安装成功！`

### 第四步：启动工具

1. **双击运行**
   ```
   双击 start_tools.bat
   ```

2. **或命令行运行**
   ```powershell
   cd C:\DCM-Nii
   .\start_tools.bat
   ```

3. **选择工具**
   ```
   =================================
       DCM-Nii 医学影像处理工具集
   =================================
   1. 元数据提取工具 (GUI)
   2. DICOM脱敏工具
   3. DICOM转换工具 (最大层数优先)
   4. DICOM转换工具 (5mm切片过滤)
   5. 查看帮助文档
   0. 退出
   =================================
   请选择 (0-5): 
   ```

✅ **轻量版安装完成！**

---

## 🖥️ 完整版安装步骤

### 完整版 = 轻量版 + MRIcroGL查看器

**前提条件**：
- ✅ 已完成"轻量版安装步骤"的第一步（安装Python）

### 第一步：下载并解压完整版

1. **下载分发包**
   - 文件：`DCM-Nii_full_20251025_134540.zip` (65.38 MB)
   - 来源：GitHub Releases 或项目分发
   - 下载时间：约1-5分钟（取决于网速）

2. **解压文件**
   ```powershell
   # 推荐解压到C盘根目录
   Expand-Archive -Path DCM-Nii_full_20251025_134540.zip -DestinationPath C:\DCM-Nii
   ```

3. **完整版目录结构**
   ```
   C:\DCM-Nii\
   ├── src/                          # Python脚本
   ├── docs/                         # 文档
   ├── data/                         # 数据目录
   ├── output/                       # 输出目录
   ├── tools/                        # 工具目录
   │   └── MRIcroGL/                 # ★ 医学影像查看器
   │       ├── MRIcroGL.exe          # 主程序（独立运行）
   │       └── Resources/            # 资源文件
   │           ├── lut/              # 40+ 色彩映射表
   │           ├── matcap/           # 20+ 材质
   │           ├── atlas/            # 脑图谱
   │           ├── dcm2niix.exe
   │           ├── bet2.exe
   │           └── python35.zip
   ├── dcm2niix.exe                  # DICOM转换工具
   ├── start_tools.bat               # 启动器
   ├── README.md
   └── requirements.txt
   ```

### 第二步：安装Python依赖

**与轻量版完全相同**，参考上面的步骤：

```powershell
cd C:\DCM-Nii
pip install -r requirements.txt
```

### 第三步：验证MRIcroGL

**MRIcroGL是独立可执行文件，无需安装！**

1. **直接运行测试**
   ```powershell
   .\tools\MRIcroGL\MRIcroGL.exe
   ```
   
2. **正常情况**
   - ✅ 应该打开MRIcroGL图形界面
   - ✅ 窗口标题显示 "MRIcroGL"
   - ✅ 可以看到菜单栏和工具栏

3. **如果无法启动**
   - 检查显卡驱动是否支持OpenGL 2.0+
   - 检查是否有杀毒软件拦截
   - 以管理员身份运行

### 第四步：启动工具集

**与轻量版完全相同**：

```powershell
.\start_tools.bat
```

### 第五步：测试MRIcroGL功能

1. **打开示例影像**
   - 菜单：File → Open
   - 或者直接拖拽NIfTI文件到窗口

2. **测试色彩映射**
   - 菜单：Overlay → Color Scheme
   - 选择不同的LUT（如hot, cool, viridis等）

3. **测试3D渲染**
   - 菜单：View → Render
   - 旋转、缩放3D模型

✅ **完整版安装完成！**

---

## 🔧 环境依赖总结

### 必需安装的软件

| 软件 | 版本 | 用途 | 安装方式 |
|------|------|------|----------|
| **Python** | 3.8-3.11 | 运行Python脚本 | 官网下载或Microsoft Store |
| **pip** | 自带 | 安装Python包 | 随Python自动安装 |

### Python依赖包（自动安装）

| 包名 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **pydicom** | ≥2.3.0 | DICOM文件读写 | `pip install -r requirements.txt` |
| **pandas** | ≥1.5.0 | 数据处理和CSV | 同上 |
| **numpy** | ≥1.20.0 | 数值计算 | 同上 |

### 内置工具（无需安装）

| 工具 | 版本 | 用途 | 说明 |
|------|------|------|------|
| **dcm2niix.exe** | 最新 | DICOM→NIfTI转换 | 独立可执行文件 |
| **MRIcroGL.exe** | 最新 | 医学影像查看器 | 独立可执行文件（仅完整版） |

### 无需安装的组件

❌ **不需要**：
- Visual Studio / C++编译器
- MATLAB / Octave
- Java / JRE
- Node.js / npm
- Docker / 虚拟机
- 其他医学影像软件

✅ **只需要**：
- Python 3.8+
- pip install 三个包

---

## ❓ 常见问题

### Q1: 提示"找不到Python命令"

**原因**：Python未添加到系统PATH

**解决方案**：
```powershell
# 方法1: 重新安装Python，勾选"Add to PATH"
# 方法2: 手动添加PATH
# 查找Python安装路径（通常是）
C:\Users\<用户名>\AppData\Local\Programs\Python\Python310\

# 添加到系统环境变量PATH
此电脑 → 属性 → 高级系统设置 → 环境变量 → Path → 新建 → 添加Python路径
```

### Q2: pip install失败，提示网络错误

**原因**：网络不稳定或被墙

**解决方案**：使用国内镜像源
```powershell
# 临时使用清华镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 或阿里云镜像
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

### Q3: 提示"缺少tkinter模块"

**原因**：Python安装时未包含tkinter（GUI工具包）

**解决方案**：
```powershell
# Windows: 重新安装Python，选择"tcl/tk and IDLE"
# 或从Microsoft Store安装的Python自带tkinter
python -m tkinter
# 应弹出小窗口，说明tkinter可用
```

### Q4: MRIcroGL无法启动

**可能原因及解决方案**：

1. **显卡不支持OpenGL 2.0+**
   - 检查显卡驱动是否最新
   - 更新显卡驱动：访问NVIDIA/AMD/Intel官网

2. **被杀毒软件拦截**
   - 添加MRIcroGL.exe到白名单
   - 临时关闭杀毒软件测试

3. **缺少VC++运行库**
   - 下载安装：Microsoft Visual C++ Redistributable
   - 链接：https://aka.ms/vs/17/release/vc_redist.x64.exe

### Q5: dcm2niix.exe转换失败

**原因**：权限不足或文件路径问题

**解决方案**：
```powershell
# 1. 以管理员身份运行start_tools.bat
右键 start_tools.bat → 以管理员身份运行

# 2. 检查路径中是否有中文或特殊字符
# 推荐使用纯英文路径，如 C:\DCM-Nii\

# 3. 检查输出目录是否有写权限
```

### Q6: 内存不足错误

**原因**：处理大型数据集时内存不足

**解决方案**：
```powershell
# 1. 关闭其他程序释放内存
# 2. 分批处理数据
# 3. 增加系统内存（推荐16GB+）
```

---

## ✅ 验证安装

### 完整安装检查清单

运行以下命令验证所有组件：

```powershell
# 进入安装目录
cd C:\DCM-Nii

# 1. 检查Python版本
python --version
# 预期输出: Python 3.10.x 或 3.8-3.11

# 2. 检查pip
pip --version
# 预期输出: pip 23.x.x

# 3. 检查Python依赖
python -c "import pydicom; print('pydicom:', pydicom.__version__)"
python -c "import pandas; print('pandas:', pandas.__version__)"
python -c "import numpy; print('numpy:', numpy.__version__)"
# 预期输出: 对应版本号

# 4. 检查dcm2niix
.\dcm2niix.exe -v
# 预期输出: 版本信息

# 5. 检查MRIcroGL（仅完整版）
.\tools\MRIcroGL\MRIcroGL.exe
# 预期输出: 打开GUI窗口

# 6. 测试启动器
.\start_tools.bat
# 预期输出: 显示菜单
```

### 快速测试脚本

创建一个测试脚本 `test_installation.ps1`：

```powershell
Write-Host "`n=== DCM-Nii 安装验证 ===`n" -ForegroundColor Cyan

# 测试Python
try {
    $pythonVersion = python --version 2>&1
    Write-Host "✅ Python: $pythonVersion" -ForegroundColor Green
} catch {
    Write-Host "❌ Python未安装或未添加到PATH" -ForegroundColor Red
}

# 测试依赖
$packages = @("pydicom", "pandas", "numpy")
foreach ($pkg in $packages) {
    try {
        python -c "import $pkg; print('$pkg OK')" 2>&1 | Out-Null
        if ($LASTEXITCODE -eq 0) {
            Write-Host "✅ $pkg: 已安装" -ForegroundColor Green
        }
    } catch {
        Write-Host "❌ $pkg: 未安装" -ForegroundColor Red
    }
}

# 测试dcm2niix
if (Test-Path ".\dcm2niix.exe") {
    Write-Host "✅ dcm2niix.exe: 存在" -ForegroundColor Green
} else {
    Write-Host "❌ dcm2niix.exe: 不存在" -ForegroundColor Red
}

# 测试MRIcroGL（完整版）
if (Test-Path ".\tools\MRIcroGL\MRIcroGL.exe") {
    Write-Host "✅ MRIcroGL.exe: 存在（完整版）" -ForegroundColor Green
} else {
    Write-Host "⚠️ MRIcroGL.exe: 不存在（轻量版）" -ForegroundColor Yellow
}

Write-Host "`n=== 验证完成 ===`n" -ForegroundColor Cyan
```

运行：
```powershell
powershell -ExecutionPolicy Bypass -File test_installation.ps1
```

---

## 📊 安装时间估算

### 轻量版

| 步骤 | 时间 | 说明 |
|------|------|------|
| 下载Python | 1-3分钟 | 约25MB |
| 安装Python | 2-5分钟 | 自动安装 |
| 下载轻量版 | <10秒 | 0.56MB |
| 解压 | <10秒 | 文件少 |
| 安装依赖 | 1-3分钟 | 下载pydicom等 |
| **总计** | **5-12分钟** | 取决于网速 |

### 完整版

| 步骤 | 时间 | 说明 |
|------|------|------|
| 下载Python | 1-3分钟 | 约25MB |
| 安装Python | 2-5分钟 | 自动安装 |
| 下载完整版 | 1-5分钟 | 65.38MB |
| 解压 | 30秒-1分钟 | 文件多 |
| 安装依赖 | 1-3分钟 | 下载pydicom等 |
| **总计** | **6-17分钟** | 取决于网速 |

---

## 🎯 推荐配置

### 最低配置（轻量版）

```
操作系统: Windows 7 (64位)
CPU: 双核 2.0GHz
内存: 4GB
硬盘: 1GB 可用空间
显卡: 集成显卡
网络: 宽带（安装依赖需要）
```

### 推荐配置（完整版）

```
操作系统: Windows 10/11 (64位)
CPU: 四核 2.5GHz+
内存: 8GB+
硬盘: 2GB+ 可用空间（处理数据需更多）
显卡: 支持OpenGL 2.0+（用于MRIcroGL 3D渲染）
网络: 宽带
```

### 专业配置（大数据集处理）

```
操作系统: Windows 10/11 (64位)
CPU: 八核 3.0GHz+
内存: 16GB+
硬盘: SSD 100GB+
显卡: 独立显卡（GTX/RTX系列，4GB+显存）
网络: 宽带
```

---

## 📝 总结

### 安装流程对比

```
【轻量版】
Python官网 → 安装Python → 解压ZIP → pip install → 完成 ✅

【完整版】  
Python官网 → 安装Python → 解压ZIP → pip install → 测试MRIcroGL → 完成 ✅
```

### 核心要点

1. ✅ **唯一必需软件**: Python 3.8-3.11
2. ✅ **三个Python包**: pydicom, pandas, numpy
3. ✅ **MRIcroGL独立运行**: 无需额外安装
4. ✅ **总安装时间**: 5-17分钟
5. ✅ **网络要求**: 仅安装时需要

### 快速启动

```powershell
# 1. 解压
Expand-Archive DCM-Nii_*.zip -DestinationPath C:\DCM-Nii

# 2. 安装依赖
cd C:\DCM-Nii
pip install -r requirements.txt

# 3. 启动
.\start_tools.bat
```

---

**如有问题，请参考**：
- 📖 主README: `README.md`
- 📘 快速指南: `dist/快速开始指南.md`
- 📙 脱敏指南: `docs/DEIDENTIFY_GUIDE.md`
- 🐛 问题反馈: https://github.com/chenqz-hub/DCM-Nii-20251001/issues

---

*最后更新: 2025-10-25*  
*版本: v2.0.0*
